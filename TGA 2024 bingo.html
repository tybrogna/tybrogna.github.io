<!DOCTYPE html>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
<style>
    @media (max-width: 999px) {
        .widener {
            position: absolute;
            max-width: 96%;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
            /* transform: translate(-0%, -50%); */
        }
    }

    .imgop {
        opacity: 0.38;
    }
    .clamp-size {
        width: 98%;
        margin-top: 2%;
        object-fit: cover;
        height: 170px;
    }
    .w2 {
        position: relative;
        top: 0;
        left: 0;
        width: 20%;
    }
    .clamp-size-top {
        width: 20%;
        height: 20px;
    }
    .tile-text {
        position: absolute;
        text-align: center;
        font-weight: bold;
        top: 50%;
        left: 5%;
        right: 5%;
        transform: translate(-0%, -50%);
        text-shadow: #FFF 1px 0 10px;
    }
</style>
<script>

    class Tile {
        text = ''
        imgLoc = ''
        constructor(text, imgLoc) {
            this.text = text
            this.imgLoc = imgLoc
            if (this.imgLoc != null) {
                if (!this.imgLoc.startsWith('./bingo-imgs-24/')) {
                    this.imgLoc = './bingo-imgs-24/' + this.imgLoc
                }
                if (!this.imgLoc.endsWith('.jpg')) {
                    this.imgLoc = this.imgLoc + '.jpg'
                }
            }
        }
    }

    const freeTile = new Tile('Tekken 7 Not Nominated for Best Score and Music')
    const tileDataList = [
        [
            new Tile('Switch 2?!?!!?', 'switch2'), new Tile('no switch 2', 'noswitch2')
        ],
        [
            new Tile('Black Myth Wukong wins anything', 'wkwin'), new Tile('Black Myth Wukong wins nothing', 'wklose')
        ],
        [
            new Tile('The same game wins GotY and Game Direction', 'spiderman'), new Tile('Different Games win GotY and Game Direction', 'nospiderman')
        ],
        [
            new Tile('FFVII Rebirth wins Game of the Year', 'cloud'), new Tile('Elden Ring reclaims GotY', 'erer'), new Tile('Dark horse Balatro wins GotY', 'joker')
        ],
        [
            new Tile('ASTRO BOT wins more than two awards', 'bot'), new Tile('ASTRO BOT wins zero awards', 'dokodemo')
        ],
        [
            new Tile('Best Fighting Game: a game that actually came out this year wins', 'hgwells'), new Tile('Best Fighting Game: A port/enhanced version wins', 'bttf')
        ],
        [
            new Tile('Best Family Game: Nintendo game wins', 'mario'), new Tile('Best Family Game: Non-Nintendo game wins', 'bot')
        ],
        [
            new Tile('Best Sports/Racing Game: A game with "24" in its title wins', '2k4'), new Tile('Best Sports/Raching Game: A game with "25" in its title wins', '2k5')
        ],
        [
            new Tile('Best Esports game: Valve game wins', 'valve'), new Tile('Best Esports Game: Riot game wins', 'riot')
        ],
        [
            new Tile('Expansion/DLC for a game released this year', 'sblade'), new Tile('Expansion/DLC for a game released in 2023 or earlier', 'zelda')
        ],
        new Tile('Geoff interviews a cringe content creator (they\'re all cringe)', 'tiktok'),
        new Tile('Geoff interviews an esports dork (they\'re all dorks)', 'mtndew'),
        new Tile('Fortnite collab announcement', 'fnite'),
        new Tile('Marvel rivals ad', 'ssquad'),
        new Tile('FFXIV jumpscare', 'meteor'),
        new Tile('Halo unreal jumpscare', 'chief'),
        new Tile('Metroid Prime 4!', 'mp4'),
        new Tile('One of MS\'s purgatorial projects appears (Everwilds, State of Decay 3, Outer Worlds 2, etc)', 'hell'),
        new Tile('New Season of ongoing game announcement', 'stonks'),
        new Tile('"Available Right Now!"', 'boom'),
        new Tile('Silksong', 'clown'),
        new Tile('Virtua Fighter shows up somehow', 'missing'),
        new Tile('Personnel from last year\'s winner presents/appears (Alan Wake 2, BG3, Zelda)', 'pirates'),
        new Tile('Big name property goes mobile', 'wow'),
        new Tile('Arknights/Genshin/Star Rail/ZZZ', 'phone'),
        new Tile('Hideo Kojima™®©', 'friends'),
        new Tile('Next Battlefield game', 'bf6'),
        new Tile('New or Upcoming Konami Game', 'tokimeki'),
        new Tile('Another Fucking MMO (drink if its korean)', 'kmmo'),
        new Tile('Gamepass ad', 'gp'),
        new Tile('Crazy Taxi, Golden Axe, Jet Set, Shinobi or Streets of Rage reappears', 'sega'),
        new Tile('No Man\'s Sky or Light No Fire reappears', 'hello'),
        new Tile('Big Name Mystery game from last year reappears (Exodus, Kemuri, Last Sentinel, OD)', 'loot'),
        new Tile('Monster Hunter Wilds', 'mhw'),
        new Tile('Naughty Dogg\'s next game', 'crash'),
        new Tile('Insomniac\'s next game', 'spyro'),
        new Tile('New Nintendo game for swtich 2 (or with a suspicious lack of confirmed platforms)', 'jumpman'),
        new Tile('Previous Xbox-only game goes multiplatform', 'lucky'),
        new Tile('Dead franchise gets steam port', 'breathoffire'),
        new Tile('VR Game', 'quest'),
        new Tile('Grand Theft Auto 6', 'gta6')
    ]

    let loadTiles = function(events) {
        let eventId = events.find(ele => ele.name == 'E3 2019 - Microsoft').id
        let url = './eventTiles/' + eventId

        let tilesxhr = new XMLHttpRequest()
        tilesxhr.open('GET', url, true)
        tilesxhr.responseType = 'json'

        tilesxhr.onload = () => {
            if (tilesxhr.status != 200) { return }
            populateCard(tilesxhr.response)
        }
        tilesxhr.send()
    }

    function shuffle(list, random) {
        let shuffleList = [...list]
        let a = shuffleList.length;
        let tval;
        let rand;

        while (a != 0) {
            rand = Math.floor(random() * a);
            a --;
            tval = shuffleList[a];
            shuffleList[a] = shuffleList[rand];
            shuffleList[rand] = tval;
        }
        return shuffleList;
    }

    // https://github.com/bryc/code/blob/master/jshash/PRNGs.md
    function jsf32b(aIn, bIn, cIn, dIn) {
        let a = aIn, b = bIn, c = cIn, d = dIn;
        return function() {
            a |= 0; b |= 0; c |= 0; d |= 0;
            var t = a - (b << 23 | b >>> 9) | 0;
            a = b ^ (c << 16 | c >>> 16) | 0;
            b = c + (d << 11 | d >>> 21) | 0;
            b = c + d | 0;
            c = d + t | 0;
            d = a + t | 0;
            let ret = (d >>> 0) / 4294967296;
            return ret
        }
    }

    // https://gist.github.com/azat/2762138
    var crc32 = function(str) {
        for(var i=256, tbl=[], crc, j; i--; tbl[i]=crc>>>0){
            j=8;for(crc=i;j--;)crc=crc&1?crc>>>1^0xEDB88320:crc>>>1;
        }
        return function(str) {
            for(var n=0, crc=-1; n<str.length; ++n)
                crc=tbl[crc&255^str.charCodeAt(n)]^crc>>>8;
            return crc^-1;
        }
    }();

    // window.onload = async () => {
    //     buildCardHtml()
    //     buildCardContent()
    // }

    window.onload = async () => {
        const response = await fetch('./bingo-imgs/z.zip');
        console.log(response)
        let zipFileReader = new zip.BlobReader('./bingo-imgs/z.zip')
        console.log(zipFileReader)
        let zipReader = new zip.ZipReader(zipFileReader)
        console.log(zipReader)
        let firstEntry = (await zipReader.getEntries()).shift()
        console.log(firstEntry)
    }


    const bingoLetters = ['b','i','n','g','o']
    const colNumbers = [1,2,3,4,5]
    function buildCardHtml() {
        colNumbers.forEach((num) => {
            let bingoRowEle = document.createElement('div')
            bingoRowEle.classList = ['row']
            bingoLetters.forEach((letter) => {
                let tileEle = document.createElement('div')
                tileEle.id = 'tile' + letter + num
                tileEle.classList = 'w2'
                let imgEle = document.createElement('img')
                imgEle.id = 'imgbox'
                imgEle.classList = 'imgop clamp-size'
                let textEle = document.createElement('div')
                textEle.id = 'tile-text-box'
                textEle.classList = 'tile-text'
                textEle.innerHTML = '-'
                tileEle.appendChild(imgEle)
                tileEle.appendChild(textEle)
                bingoRowEle.appendChild(tileEle)
            })
            document.querySelector('#main').appendChild(bingoRowEle)
        })
    }

    function createTickElement() {
        let imgbox = document.createElement('div')
        imgbox.id = 'checkbox'
        let omg = document.createElement('img')
        omg.id = "tick"
        omg.style.position = 'absolute'
        omg.style.top = '50%'
        omg.style.left = '50%'
        omg.style.transform = 'translate(-50%, -50%)'
        omg.src = './bingo-imgs/correct.png'
        omg.style.visibility = 'hidden'

        imgbox.appendChild(omg)
        return imgbox
    }

    function buildCardContent() {
        let seedText = document.querySelector('#seed-box').value
        let v = crc32(seedText)
        let random = jsf32b(0xF1EA5EED,v,v,v)
        let shuffled = shuffle(tileDataList, random)
        let count = 0
        colNumbers.forEach((num) => {
            bingoLetters.forEach((letter) => {
                let tileEle = document.querySelector('#tile' + letter + num)
                let tileData = shuffled[++count]
                if (tileEle.id == 'tilen3') {
                    tileData = freeTile
                }
                // applyTileData(tileEle, tileData)
                tileEle.append(createTickElement())
                tileEle.addEventListener('click', event => {
                    let visStatus = tileEle.querySelector('#tick').style.visibility
                    if (visStatus == 'visible') {
                        visStatus = 'hidden'
                    } else {
                        visStatus = 'visible'
                    }
                })
                if (tileData.length > 0) {
                    pick = Math.floor(random() * tileData.length)
                    tileData = tileData[pick]
                }
                tileEle.querySelector('#imgbox').src = tileData.imgLoc

                // tile.append(createTickElement())
                // tile.addEventListener(`click`, event => {
                //     if (tile.querySelector("#tick").style.visibility == 'visible') {
                //         tile.querySelector("#tick").style.visibility = 'hidden'
                //     } else {
                //         tile.querySelector("#tick").style.visibility = 'visible'
                //     }
                // })

                // // let tileData = shuffled[++count]
                // if (tileData.length > 0) {
                //     pick = Math.floor(random() * tileData.length)
                //     tileData = tileData[pick]
                // }
                // tile.querySelector('#tile-text-box').innerHTML = tileData.text
                // if (!tileData.imgLoc.startsWith('./bingo-imgs/')) {
                //     tileData.imgLoc = './bingo-imgs/' + tileData.imgLoc
                // }
                // if (!tileData.imgLoc.endsWith('.jpg')) {
                //     tileData.imgLoc = tileData.imgLoc + '.jpg'
                // }
                // tile.querySelector('#imgbox').src = tileData.imgLoc
            })
        })
    }

    function applyTileData(tileEle, tileData) {
        tileEle.append(createTickElement())
        tileEle.addEventListener('click', event => {
            let visStatus = tileEle.querySelector('#tick').style.visibility
            if (visStatus == 'visible') {
                visStatus = 'hidden'
            } else {
                visStatus = 'visible'
            }
        })
        if (tileData.length > 0) {
            pick = Math.floor(random() * tileData.length)
            tileData = tileData[pick]
        }
        tileEle.querySelector('#imgbox').src = tileData.imgLoc
    }

</script>
<div id="main" class="container widener">
    <div class="row">
        <span>Card Seed</span>
        <input id="seed-box" value="33"></input>
        <button onclick="buildCardContent()">Regenerate</button>
    </div>
    <div class="row">
        <div class="text-center clamp-size-top box-shadow">
            <p class="">B</p>
        </div>
        <div class="text-center clamp-size-top box-shadow">
            <p class="">I</p>
        </div>
        <div class="text-center clamp-size-top box-shadow">
            <p class="">N</p>
        </div>
        <div class="text-center clamp-size-top box-shadow">
            <p class="">G</p>
        </div>
        <div class="text-center clamp-size-top box-shadow">
            <p class="">O</p>
        </div>
    </div>
</div>